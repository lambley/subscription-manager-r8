<div class="relative w-full overflow-auto" data-controller="subscription">
  <h2 class="text-2xl font-semibold mb-4">Summary</h2>
  <table class="w-full caption-bottom border-border border-2 text-sm">
    <thead class="[&_tr]:border-b">
      <tr class="border-b border-border text-text transition-colors bg-main font-base data-[state=selected]:bg-white data-[state=selected]:text-text">
        <th class="h-12 px-4 text-left align-middle font-heading text-text [&:has([role=checkbox])]:pr-0 w-[100px]">Type</th>
        <th class="h-12 px-4 text-left align-middle font-heading text-text [&:has([role=checkbox])]:pr-0 w-[100px]">Actual</th>
        <th class="h-12 px-4 text-left align-middle font-heading text-text [&:has([role=checkbox])]:pr-0 w-[100px]">Budget</th>
      </tr>
    </thead>
    <tbody class="[&_tr:last-child]:border-0">
      <tr class="border-b border-border text-text transition-colors bg-main font-base data-[state=selected]:bg-white data-[state=selected]:text-text">
        <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-base">Monthly</td>
        <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-base"><%= number_to_currency(total_cost(subscriptions, "monthly")) %></td>
        <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-base  flex items-center space-x-2">
          <% if Current.user.budget.present? %>
            <span id="monthly-budget-display" data-subscription-target="monthlyBudgetDisplay" class="w-full"><%= number_to_currency(Current.user.budget / 12) %></span>
            <input type="text" id="monthly-budget-input" data-subscription-target="monthlyBudgetInput" class="border rounded p-2 hidden w-full" value="<%= Current.user.budget / 12 %>" data-action="keydown->subscription#handleKeydown">
          <% else %>
            <span id="monthly-budget-display" data-subscription-target="monthlyBudgetDisplay" class="w-full text-red-500">Budget not set</span>
            <input type="text" id="monthly-budget-input" data-subscription-target="monthlyBudgetInput" class="border rounded p-2 hidden w-full" placeholder="Set your budget" data-action="keydown->subscription#handleKeydown">
          <% end %>
          <%= render_button(
              text: 'Edit',
              icon: 'fa-regular fa-pen-to-square',
              link: '#',
              button_type: 'link_to',
              data: {
                controller: 'subscription',
                action: 'click->subscription#toggleMonthlyBudgetEdit',
                target: 'editMonthlyButton'
              },
              bg_class: 'bg-blue-500 text-white',
              id: 'edit-monthly-budget',
            ) %>
          <%= render_button(
              text: 'Save',
              icon: 'fa-regular fa-floppy-disk',
              link: '#',
              button_type: 'link_to',
              data: {
                controller: 'subscription',
                action: 'click->subscription#saveMonthlyBudget',
                target: 'saveMonthlyButton'
              },
              bg_class: 'bg-green-500 text-white',
              class: 'hidden',
              id: 'save-monthly-budget'
            ) %>
          <%= render_button(
              text: 'Cancel',
              icon: 'fa-solid fa-xmark',
              link: '#',
              button_type: 'link_to',
              data: {
                controller: 'subscription',
                action: 'click->subscription#toggleMonthlyBudgetEdit',
                target: 'cancelMonthlyButton'
              },
              bg_class: 'bg-gray-500 text-white',
              class: 'hidden',
              id: 'cancel-monthly-budget'
            ) %>
        </td>
      </tr>
      <tr class="border-b border-border text-text transition-colors bg-main font-base data-[state=selected]:bg-white data-[state=selected]:text-text">
        <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-base">Annual</td>
        <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-base"><%= number_to_currency(total_cost(subscriptions, "annual")) %></td>
        <td class="p-4 align-middle [&:has([role=checkbox])]:pr-0 font-base flex items-center space-x-2">
          <% if Current.user.budget.present? %>
            <span id="annual-budget-display" data-subscription-target="annualBudgetDisplay" class="w-full"><%= number_to_currency(Current.user.budget) %></span>
            <input type="text" id="annual-budget-input" data-subscription-target="annualBudgetInput" class="border rounded p-2 hidden w-full" value="<%= Current.user.budget %>" data-action="keydown->subscription#handleKeydown">
          <% else %>
            <span id="annual-budget-display" data-subscription-target="annualBudgetDisplay" class="w-full text-red-500">Budget not set</span>
            <input type="text" id="annual-budget-input" data-subscription-target="annualBudgetInput" class="border rounded p-2 hidden w-full" placeholder="Set your budget" data-action="keydown->subscription#handleKeydown">
          <% end %>
          <%= render_button(
              text: 'Edit',
              icon: 'fa-regular fa-pen-to-square',
              link: '#',
              button_type: 'link_to',
              data: {
                controller: 'subscription',
                action: 'click->subscription#toggleAnnualBudgetEdit',
                target: 'editAnnualButton'
              },
              bg_class: 'bg-blue-500 text-white',
              id: 'edit-annual-budget',
            ) %>
          <%= render_button(
              text: 'Save',
              icon: 'fa-regular fa-floppy-disk',
              link: '#',
              button_type: 'link_to',
              data: {
                controller: 'subscription',
                action: 'click->subscription#saveAnnualBudgetEdit',
                target: 'saveAnnualButton'
              },
              bg_class: 'bg-green-500 text-white0',
              id: 'save-annual-budget',
              class: 'hidden'
            ) %>
          <%= render_button(
              text: 'Cancel',
              icon: 'fa-solid fa-xmark',
              link: '#',
              button_type: 'link_to',
              data: {
                controller: 'subscription',
                action: 'click->subscription#toggleAnnualBudgetEdit',
                target: 'cancelAnnualButton'
              },
              bg_class: 'bg-gray-500 text-white',
              id: 'cancel-annual-budget',
              class: 'hidden'
            ) %>
        </td>
      </tr>
    </tbody>
  </table>
</div>
